# install.packages("devtools")
devtools::install_github("MikeJSeo/network-meta")
# If needed install these packages.
# install.packages("metafor")
# install.packages("lme4")
# install.packages("plyr")
# install.packages("igraph")
##########################NETWORK META-ANALYSIS#################################
library(metafor)
library(igraph)
library(plyr)
### load data
data("dat.hasselblad1998")
#The dataset includes the results from 24 studies on the effectiveness of various counseling types for
#smoking cessation (i.e., self-help, individual counseling, group counseling, and no contact). The
#dataset indicates the total number of individuals within each study arm and the number that were
#abstinent from 6 to 12 months. The majority of the studies compared two interventions types against
#each other, while 2 studies compared three types against each other simultaneously
### calculate log odds for each study arm
dat <- escalc(measure="PLO", xi=xi, ni=ni, add=1/2, to="all", data=dat.hasselblad1998)
dat
pairs <- do.call(rbind, sapply(split(network$Treat, network$Study)),
function(x) t(combn(x,2))))
pairs <- aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
pairs <- do.call(rbind, sapply(split(network$Treat, network$Study)),
function(x) t(combn(x,2)))
pairs <- aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
pairs <- do.call(rbind, sapply(split(network$Treat, network$Study)),
function(x) t(combn(x,2)))
dat
network <- dat
network
Outcomes <- c(15, 146, 4, 80, 9, 28, 19, 81, 5, 37, 1, 23, 33, 110, 22, 61, 0, 15, 5, 5, 14, 26, 22, 90)
N <- c(199, 393, 127, 246, 63, 65, 200, 207, 62, 67, 30, 59, 363, 360, 110, 165, 47, 49, 40, 40, 49, 50, 204, 205)
Study <- c("RAPID 1", "RAPID 1", "RAPID 2", "RAPID 2", "Kim 2007", "Kim 2007", "DE019", "DE019", "ARMADA", "ARMADA", "Weinblatt 1999", "Weinblatt 1999", "START", "START", "ATTEST", "ATTEST", "Abe 2006", "Abe 2006", "Strand 2006", "Strand 2006", "CHARISMA", "CHARISMA", "OPTION", "OPTION")
Treat <- c("Placebo", "CZP", "Placebo", "CZP", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Etanercept", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Rituximab", "Placebo", "Tocilizumab", "Placebo", "Tocilizumab")
covariate <- c(6.15, 5.85, 6.85, 10.95, 11.65, 13, 8.1, 7.85, 8.3, 11.25, 0.915, 7.65)
Treat.order <- c("Placebo", "CZP", "Adalimumab", "Etanercept", "Infliximab", "Rituximab", "Tocilizumab")
network <- network.data(Outcomes, Study, Treat, N=N, response = "binomial", Treat.order = Treat.order, covariate = covariate, hy.prior = list("dhnorm", 0, 9.77))
library(mcnet)
Outcomes <- c(15, 146, 4, 80, 9, 28, 19, 81, 5, 37, 1, 23, 33, 110, 22, 61, 0, 15, 5, 5, 14, 26, 22, 90)
N <- c(199, 393, 127, 246, 63, 65, 200, 207, 62, 67, 30, 59, 363, 360, 110, 165, 47, 49, 40, 40, 49, 50, 204, 205)
Study <- c("RAPID 1", "RAPID 1", "RAPID 2", "RAPID 2", "Kim 2007", "Kim 2007", "DE019", "DE019", "ARMADA", "ARMADA", "Weinblatt 1999", "Weinblatt 1999", "START", "START", "ATTEST", "ATTEST", "Abe 2006", "Abe 2006", "Strand 2006", "Strand 2006", "CHARISMA", "CHARISMA", "OPTION", "OPTION")
Treat <- c("Placebo", "CZP", "Placebo", "CZP", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Etanercept", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Rituximab", "Placebo", "Tocilizumab", "Placebo", "Tocilizumab")
covariate <- c(6.15, 5.85, 6.85, 10.95, 11.65, 13, 8.1, 7.85, 8.3, 11.25, 0.915, 7.65)
Treat.order <- c("Placebo", "CZP", "Adalimumab", "Etanercept", "Infliximab", "Rituximab", "Tocilizumab")
network <- network.data(Outcomes, Study, Treat, N=N, response = "binomial", Treat.order = Treat.order, covariate = covariate, hy.prior = list("dhnorm", 0, 9.77))
library(mcnet)
# install.packages("devtools")
devtools::install_github("MikeJSeo/network-meta")
Outcomes <- c(15, 146, 4, 80, 9, 28, 19, 81, 5, 37, 1, 23, 33, 110, 22, 61, 0, 15, 5, 5, 14, 26, 22, 90)
N <- c(199, 393, 127, 246, 63, 65, 200, 207, 62, 67, 30, 59, 363, 360, 110, 165, 47, 49, 40, 40, 49, 50, 204, 205)
Study <- c("RAPID 1", "RAPID 1", "RAPID 2", "RAPID 2", "Kim 2007", "Kim 2007", "DE019", "DE019", "ARMADA", "ARMADA", "Weinblatt 1999", "Weinblatt 1999", "START", "START", "ATTEST", "ATTEST", "Abe 2006", "Abe 2006", "Strand 2006", "Strand 2006", "CHARISMA", "CHARISMA", "OPTION", "OPTION")
Treat <- c("Placebo", "CZP", "Placebo", "CZP", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Etanercept", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Rituximab", "Placebo", "Tocilizumab", "Placebo", "Tocilizumab")
covariate <- c(6.15, 5.85, 6.85, 10.95, 11.65, 13, 8.1, 7.85, 8.3, 11.25, 0.915, 7.65)
Treat.order <- c("Placebo", "CZP", "Adalimumab", "Etanercept", "Infliximab", "Rituximab", "Tocilizumab")
network <- network.data(Outcomes, Study, Treat, N=N, response = "binomial", Treat.order = Treat.order, covariate = covariate, hy.prior = list("dhnorm", 0, 9.77))
Outcomes <- c(15, 146, 4, 80, 9, 28, 19, 81, 5, 37, 1, 23, 33, 110, 22, 61, 0, 15, 5, 5, 14, 26, 22, 90)
N <- c(199, 393, 127, 246, 63, 65, 200, 207, 62, 67, 30, 59, 363, 360, 110, 165, 47, 49, 40, 40, 49, 50, 204, 205)
Study <- c("RAPID 1", "RAPID 1", "RAPID 2", "RAPID 2", "Kim 2007", "Kim 2007", "DE019", "DE019", "ARMADA", "ARMADA", "Weinblatt 1999", "Weinblatt 1999", "START", "START", "ATTEST", "ATTEST", "Abe 2006", "Abe 2006", "Strand 2006", "Strand 2006", "CHARISMA", "CHARISMA", "OPTION", "OPTION")
Treat <- c("Placebo", "CZP", "Placebo", "CZP", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Etanercept", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Rituximab", "Placebo", "Tocilizumab", "Placebo", "Tocilizumab")
covariate <- c(6.15, 5.85, 6.85, 10.95, 11.65, 13, 8.1, 7.85, 8.3, 11.25, 0.915, 7.65)
Treat.order <- c("Placebo", "CZP", "Adalimumab", "Etanercept", "Infliximab", "Rituximab", "Tocilizumab")
network <- network.data(Outcomes, Study, Treat, N=N, response = "binomial", Treat.order = Treat.order, covariate = covariate, hy.prior = list("dhnorm", 0, 9.77))
library(mcnet)
Outcomes <- c(15, 146, 4, 80, 9, 28, 19, 81, 5, 37, 1, 23, 33, 110, 22, 61, 0, 15, 5, 5, 14, 26, 22, 90)
N <- c(199, 393, 127, 246, 63, 65, 200, 207, 62, 67, 30, 59, 363, 360, 110, 165, 47, 49, 40, 40, 49, 50, 204, 205)
Study <- c("RAPID 1", "RAPID 1", "RAPID 2", "RAPID 2", "Kim 2007", "Kim 2007", "DE019", "DE019", "ARMADA", "ARMADA", "Weinblatt 1999", "Weinblatt 1999", "START", "START", "ATTEST", "ATTEST", "Abe 2006", "Abe 2006", "Strand 2006", "Strand 2006", "CHARISMA", "CHARISMA", "OPTION", "OPTION")
Treat <- c("Placebo", "CZP", "Placebo", "CZP", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Etanercept", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Rituximab", "Placebo", "Tocilizumab", "Placebo", "Tocilizumab")
covariate <- c(6.15, 5.85, 6.85, 10.95, 11.65, 13, 8.1, 7.85, 8.3, 11.25, 0.915, 7.65)
Treat.order <- c("Placebo", "CZP", "Adalimumab", "Etanercept", "Infliximab", "Rituximab", "Tocilizumab")
network <- network.data(Outcomes, Study, Treat, N=N, response = "binomial", Treat.order = Treat.order, covariate = covariate, hy.prior = list("dhnorm", 0, 9.77))
pairs <- do.call(rbind, sapply(split(network$Treat, network$Study)),
function(x) t(combn(x,2)))
network$Treat
network$Study
pairs <- do.call(rbind, sapply(split(network$Treat, network$Study),
function(x) t(combn(x,2))))
help(split)
pairs <- do.call(rbind, sapply(split(network$Treat, as.factor(network$Study)),
function(x) t(combn(x,2))))
pairs <- do.call(rbind, sapply(split(as.factor(network$Treat), as.factor(network$Study)),
function(x) t(combn(x,2))))
split(as.factor(network$Treat)
)
interaction(network$Treat, network$Study)
network$Treat
network$Study
network$Treat
split(network$Treat, network$Study)
a <- split(network$Treat, network$Study)
a[[1]]
t(combn(a[[1]],2))
combn(a[[1]],2)
sapply(split(network$Treat), network$Study),
function(x) t(combn(x,2)))
sapply(split(network$Treat), network$Study),
function(x) t(combn(x,2))
pairs <- do.call(rbind, sapply(split(network$Treat, network$Study),
function(x) t(combn(x,2))))
sapply(split(network$Treat, network$Study),
function(x) t(combn(x,2)))
sapply(split(network$Treat, network$Study),
function(x) t(combn(x,2)), drop = FAKLSE)
sapply(split(network$Treat, network$Study),
function(x) t(combn(x,2)), drop = FALSE)
split(network$Treat, network$Study),
function(x) t(combn(x,2)))
lapply(split(network$Treat, network$Study),
function(x) t(combn(x,2)))
do.call(rbind, lapply(split(network$Treat, network$Study),
function(x) t(combn(x,2))))
network$Treat
ls(package:mcnet)
smoking$Treat
smoking$Study
smoking$Outcomes
smoking
network <- network.data(Outcomes, Study, Treat, N=N, response = "binomial")
network
pairs <- do.call(rbind, lapply(split(network$Treat, network$Study),
function(x) t(combn(x,2))))
``pairs
pairs
network$Treat
network$Study
network <- with(smoking, network.data(Outcomes, Study, Treat, N=N, response = "binomial"))
network
pairs <- do.call(rbind, lapply(split(network$Treat, network$Study),
function(x) t(combn(x,2))))
pairs
network$Treat
network$Study
pairs <- aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
pairs
pairs <- do.call(rbind, lapply(split(network$Treat, network$Study),
function(x) t(combn(x,2))))
aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
do.call(rbind, lapply(split(network$Treat, network$Study),
function(x) t(combn(x,2))))
pairs <- aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
g <- graph.edgelist(as.matrix(pairs[,1:2]), directed=FALSE)
plot(g, edge.curved=FALSE, edge.width=pairs$freq, vertex.label.dist=.7,
vertex.label=c("Individual\nCounseling", "Group\nCounseling", "No Contact", "Self-Help"))
networK$Treat
network$Treat
g
help("graph.edgelist")
help(igraph)
pairs <- do.call(rbind, lapply(split(network$Treat, network$Study),
function(x) t(combn(x,2))))
pairs <- aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
g <- graph.edgelist(as.matrix(pairs[,1:2]), directed=FALSE)
plot(g, edge.curved=FALSE, edge.width=pairs$freq, vertex.label.dist=.7)
draw.network.graph = function(network){
pairs <- do.call(rbind, lapply(split(network$Treat, network$Study),
function(x) t(combn(x,2))))
pairs <- aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
g <- graph.edgelist(as.matrix(pairs[,1:2]), directed=FALSE)
plot(g, edge.curved=FALSE, edge.width=pairs$freq, vertex.label.dist=.7)
}
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
Outcomes <- c(15, 146, 4, 80, 9, 28, 19, 81, 5, 37, 1, 23, 33, 110, 22, 61, 0, 15, 5, 5, 14, 26, 22, 90)
N <- c(199, 393, 127, 246, 63, 65, 200, 207, 62, 67, 30, 59, 363, 360, 110, 165, 47, 49, 40, 40, 49, 50, 204, 205)
Study <- c("RAPID 1", "RAPID 1", "RAPID 2", "RAPID 2", "Kim 2007", "Kim 2007", "DE019", "DE019", "ARMADA", "ARMADA", "Weinblatt 1999", "Weinblatt 1999", "START", "START", "ATTEST", "ATTEST", "Abe 2006", "Abe 2006", "Strand 2006", "Strand 2006", "CHARISMA", "CHARISMA", "OPTION", "OPTION")
Treat <- c("Placebo", "CZP", "Placebo", "CZP", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Adalimumab", "Placebo", "Etanercept", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Infliximab", "Placebo", "Rituximab", "Placebo", "Tocilizumab", "Placebo", "Tocilizumab")
covariate <- c(6.15, 5.85, 6.85, 10.95, 11.65, 13, 8.1, 7.85, 8.3, 11.25, 0.915, 7.65)
Treat.order <- c("Placebo", "CZP", "Adalimumab", "Etanercept", "Infliximab", "Rituximab", "Tocilizumab")
network <- network.data(Outcomes, Study, Treat, N=N, response = "binomial", Treat.order = Treat.order, covariate = covariate, hy.prior = list("dhnorm", 0, 9.77))
draw.network.graph = function(network){
pairs <- do.call(rbind, lapply(split(network$Treat, network$Study),
function(x) t(combn(x,2))))
pairs <- aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
g <- graph.edgelist(as.matrix(pairs[,1:2]), directed=FALSE)
plot(g, edge.curved=FALSE, edge.width=pairs$freq, vertex.label.dist=.7)
}
Outcomes = c(3, 3, 14, 7, 11, 5, 127, 102, 27, 28, 6, 4, 152, 98, 48, 60, 37, 25, 188, 138, 52, 64, 47, 45, 16, 9, 45, 57, 31, 25, 38, 33, 12, 28, 6, 8, 3, 6, 40, 32, 43, 27, 39, 22)
N = c(39, 38, 116, 114, 93, 69, 1520, 1533, 365, 355, 52, 59, 939, 945, 471, 632, 282, 278, 1921, 1916, 583, 873, 266, 263, 293, 291, 883, 858, 147, 154, 213, 207, 122, 251, 154, 151, 134, 174, 218, 209, 364, 391, 674, 680)
Study = rep(1:22, each = 2)
Treat = rep(c(1,2), 22)
blocker <- list(Outcomes = Outcomes, N = N, Study = Study, Treat = Treat)
#covariate <- as.matrix(cbind(sample(22), sample(30, size = 22)), ncol = 2)
#add one more arm (three arm)
Outcomes = c(Outcomes, 21)
N = c(N, 660)
Study = c(Study, 22)
Treat = c(Treat, 3)
network <- network.data(Outcomes, Study, Treat, N = N, response = "binomial")
draw.network.graph(network)
Study <- june.data[,1]
Treat <- june.data[,2]
Treat <- letters[Treat]
Outcomes <- read.table(textConnection('
Alive FNonCVD OFCVD  FS FCHD
3869  200   33   27  373
4014  167   22   22  287
8760  570  111  119  707
8941  547   98   96  587
2607  149   21   14  122
2593  163   19   22   94
4544  341   82   56  162
4539  336   82   53  160
1328   45    8    5   24
1367   36    6    1   18
2155  113   18   41   39
2149  138   14   24   40
1967   49    6   12  189
2039   46   11   14  111
4075  156   20   20  178
4073  143   25   23  175
1882   66    6    5  119
1901   68    8    8   96
3158   62    6    6   61
3196   56    5    4   41
4724  127   14   14  127
4711  158   13   12  101
3224   52    5    5   15
3224   63    3    3   11
640   15    3    2   15
643   10    3    3   17
3887   61    2    2   14
3812   44    1    1    8
4925  130   10   10   62
4983  111    9    9   56
2102   21   14   13   82
2161   21   10   10   63
1131   31    5    4   28
1140   32    5    5   29'), header = TRUE)
#Outcomes <- Outcomes[,c(2,1,3,4,5)] # change base category to be 2
#Outcomes <- Outcomes[,c(1,2,5)]
#Outcomes[,c(3,4)] <- Outcomes[,c(3,4)] * 10
N <- apply(Outcomes, 1, sum)
#covariate <- as.matrix(cbind(sample(17), sample(30, size = 17)), ncol = 2)
covariate <- as.matrix(sample(30, size = 17), ncol = 1)
network <- network.data(Outcomes, Study, Treat, N, response = "multinomial", dic = FALSE)
ls(package:mcnet)
thrombolytic
network <- with(thrombolytic, network.data(Outcomes, Study, Treat, N=N, response = "binomial"))
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
draw.network.graph(network)
ls(package:network)
ls("package:network")
library(network)
ls("package:mcnet")
network <- with(blocker, network.data(Outcomes, Study, Treat, N=N, response = "binomial"))
draw.network.graph(network)
network <- with(blocker, network.data(Outcomes, Study, Treat, N=N, response = "binomial"))
draw.network.graph(network)
library(mcnet)
cardiovascular
blocker
ls("package:mcnet")
network <- with(cardiovascular, network.data(Outcomes, Study, Treat, N=N, response = "multinomial"))
draw.network.graph(network)
cardiovascular
ls("package:mcnet")
network <- with(blocker, network.data(Outcomes, Study, Treat, N=N, response = "binomial"))
network <- with(cardiovascular, network.data(Outcomes, Study, Treat, N=N, response = "multinomial"))
network <-with(parkinsons_contrast, contrast.network.data(Outcomes, Treat, SE, na, V))
network
network <-with(parkinsons_contrast, contrast.network.data(Outcomes, Treat, SE, na, V))
draw.network.graph(network)
network$Treat
network$Study
network
contrast.network.data
network$Treat
c(network$Treat)
c(t(network$Treat))
c(t(network$Treat))[!is.na(c(t(network$Treat)))]
contrast.network.data
network$na_count
network$na
rep(1:length(network$na), each = network$na)
help(rep)
rep(1:length(network$na), times = network$na)
draw.network.graph = function(network){
ifelse(class(network) == "contrast.network.data")
Treat <- c(t(network$Treat))[!is.na(c(t(network$Treat)))]
Study <- rep(1:length(network$na), times = network$na)
} else{
Treat <- network$Treat
Study <- network$Study
}
pairs <- do.call(rbind, lapply(split(Treat, Study),
function(x) t(combn(x,2))))
pairs <- aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
g <- graph.edgelist(as.matrix(pairs[,1:2]), directed=FALSE)
plot(g, edge.curved=FALSE, edge.width=pairs$freq, vertex.label.dist=.7)
}
draw.network.graph = function(network){
ifelse(class(network) == "contrast.network.data"){
Treat <- c(t(network$Treat))[!is.na(c(t(network$Treat)))]
Study <- rep(1:length(network$na), times = network$na)
} else{
Treat <- network$Treat
Study <- network$Study
}
pairs <- do.call(rbind, lapply(split(Treat, Study),
function(x) t(combn(x,2))))
pairs <- aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
g <- graph.edgelist(as.matrix(pairs[,1:2]), directed=FALSE)
plot(g, edge.curved=FALSE, edge.width=pairs$freq, vertex.label.dist=.7)
}
draw.network.graph = function(network){
if(class(network) == "contrast.network.data"){
Treat <- c(t(network$Treat))[!is.na(c(t(network$Treat)))]
Study <- rep(1:length(network$na), times = network$na)
} else{
Treat <- network$Treat
Study <- network$Study
}
pairs <- do.call(rbind, lapply(split(Treat, Study),
function(x) t(combn(x,2))))
pairs <- aggregate(rep(1, length(X1)) ~ X1 + X2, data = data.frame(pairs), sum)
g <- graph.edgelist(as.matrix(pairs[,1:2]), directed=FALSE)
plot(g, edge.curved=FALSE, edge.width=pairs$freq, vertex.label.dist=.7)
}
network <- with(blocker, network.data(Outcomes, Study, Treat, N=N, response = "binomial"))
draw.network.graph(network)
network <- with(cardiovascular, network.data(Outcomes, Study, Treat, N=N, response = "multinomial"))
draw.network.graph(network)
network <-with(parkinsons_contrast, contrast.network.data(Outcomes, Treat, SE, na, V))
draw.network.graph(network)
parkinsons_contrast
parkinsons
network <- with(parkinsons, network.data(Outcomes, Study, Treat, SE = SE, response = "normal"))
draw.network.graph(network)
smoking
statins
network <- with(statins, network.data(Outcomes, Study, Treat, N=N, response = "binomial"))
draw.network.graph(network)
thrombolytic
network <- with(thrombolytic, network.data(Outcomes, Study, Treat, N=N, response = "binomial"))
draw.network.graph(network)
devtools::document()
setwd("~/GitHub/network-meta")
devtools::document()
help(igraph)
